<div id="dataView" [ngClass]="{'data-blur': dataLoading == true }">

    <app-dataloader-div id="dataLoader"></app-dataloader-div>


    <div class="site-meta">
        <h1>Data</h1>
        <h3 *ngIf="showSiteData && !noData"><b>Sites:</b> {{selectedSites.join(", ")}}</h3>
        <h3 *ngIf="showSiteData && !noData"><b>Characteristics:</b> {{charsWithSites.join(", ")}}</h3>
    </div>

    <div [class.hidden]="showSiteData || noData" class="chart-wrapper">
        <div class="chart" id="typeChart"></div>
        <div class="chart" id="orgChart"></div>
    </div>

    <div [class.hidden]="!showSiteData || noData">
        <div *ngIf="charTypes.length > 1">
            <label class="charType">Measurement Type:</label>
            <select [(ngModel)]="selectedChar" (change)="createCharts($event.target.value, false)">
                <option *ngFor="let char of charTypes" [value]="char">{{char}}</option>
            </select>
        </div>
        <div class="chart-wrapper" id="charts"></div>

        <div *ngIf="noGraphData" id="noGraphData">
                <h5>No data points to graph.</h5>
            </div>

        <div style="text-align: center;" [class.hidden]="noGraphData"><i class="fa fa-mouse-pointer"></i>Drag a box around points on the graph to
            zoom in</div>

        <button (click)="downloadFile()"><i class="fa fa-file-download"></i>Download Results CSV</button>
        <button (click)="makeModalChart()"><i class="fa fa-book-open"></i>Report</button>
        <table id="dataTable">
            <thead>
                <tr class="row header">
                    <th *ngIf="selectedSites.length > 1">Site Name</th>
                    <th>Activity Start Date</th>
                    <th>Characteristic</th>
                    <th>Depth</th>
                    <th>Value</th>
                    <th>Fraction</th>
                    <th>Provider</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let sample of resultJson" class="row">
                    <td *ngIf="selectedSites.length > 1">{{sample.MonitoringLocationIdentifier}}</td>
                    <td>{{sample.ActivityStartDate}}</td>
                    <td>{{sample.CharacteristicName}}</td>
                    <td>{{sample['ActivityBottomDepthHeightMeasure/MeasureValue']}}
                        {{sample['ActivityBottomDepthHeightMeasure/MeasureUnitCode']}}</td>
                    <td>{{sample.ResultMeasureValue}} {{sample['ResultMeasure/MeasureUnitCode']}}</td>
                    <td>{{sample.ResultSampleFractionText}}</td>
                    <td>{{sample.ProviderName}}</td>
                </tr>
            </tbody>
        </table>

    </div>
    <div *ngIf="noData" id="noData">
        <h2>No data was returned</h2>
    </div>
</div>

<div class="modal-wrapper" *ngIf="showModal" (click)="showModal = false">
    <div class="modal" id="reportModal" (click)="$event.stopPropagation()">
        <div class="modal-header hidden-print">
            <div class="title">Report</div>
            <div class="modal-close" (click)="showModal = false">&times;</div>
        </div>
        <div class="modal-content" id="printArea">
            <h4><b>Sites:</b> {{selectedSites.join(", ")}}</h4>
            <h4><b>Characteristics:</b> {{charsWithSites.join(", ")}}</h4>
            <div *ngIf="charTypes.length > 1">
                <label class="charType">Measurement Type:</label>
                <select [(ngModel)]="selectedChar" (change)="createCharts($event.target.value, true)">
                    <option *ngFor="let char of charTypes" [value]="char">{{char}}</option>
                </select>
            </div>
            <div class="chart" id="modalCharts"></div>
            <div id="modalTable"></div>
            <div class="modal-actions hidden-print">
                <button (click)="printReport()"><i class="fa fa-print"></i>Print</button>
            </div>
        </div>

    </div>
</div>